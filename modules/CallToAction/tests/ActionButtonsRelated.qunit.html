<!DOCTYPE HTML>
<html>
<head>
<title>Call to Action - Buttons with Related</title>
<script type="text/javascript" src="../../../tests/qunit/qunit-bootstrap.js"></script>
<script type="text/javascript" src="../../../mwEmbedLoader.php"></script>
<script type="text/javascript" src="../../../docs/js/doc-bootstrap.js"></script>
<script type="text/javascript">	
function jsKalturaPlayerTest( videoId ){
	
	// Name this module
	module( "Action button player" );

	var $iframe = $('#' + videoId + '_ifp').contents();
	var iframeContext = window.frames[ videoId + '_ifp'];
	var kdp = $('#' + videoId )[0];
	
	asyncTest( "Iframe in DOM", function() {
		ok( $('#' + videoId + '_ifp').length , 'iframe found' );
		equal( typeof iframeContext, 'object', "iframe JavaScript context available" );
		start();
	});
	
	asyncTest("Buttons in Layout", function(){
		kalturaQunitWaitForPlayer(function(){
			
			window[ 'kTestEndScreen' ] = function() {
				setTimeout(function(){
				var $btn = $iframe.find('a[data-id=product]');
				ok( $btn.length, "Button Id 'product' found" );
				equal( $btn.text(), "Buy this Product", "Button text match" );
				start();
				}, 100);
			};

			kdp.addJsListener( "playerPlayEnd", "kTestEndScreen" );
			// Start playback
			kdp.sendNotification('doPlay');
			var seekTo = kdp.evaluate('{duration}') - 2;
			// Seek to seconds before end
			kdp.sendNotification('doSeek', seekTo);			
		});
	});

}
</script>
</head>
<body>
<h2>Call to Action - Buttons with Related</h2>
<br />
<div id="kdp" style="width:600px;height:370px;float:left"></div>
<script type="text/javascript" src="../../KalturaSupport/tests/resources/qunit-kaltura-bootstrap.js"></script>
<script>
	kWidget.featureConfig({
		'targetId': 'kdp',
		'wid': '_27017',
		'uiconf_id' : '38778581',
		'entry_id' : '1_6l2aslet',
		'flashvars': {
			actions: {
				"button1": {
					"label": "button1",
					"labelMetadataField": "Button1label",
					"url": "http://www.kaltura.com",
					"urlMetadataField": "Button1url"
				},
				"button2": {
					"label": "button2",
					"labelMetadataField": "Button2label",
					"url": "http://player.kaltura.com",
					"urlMetadataField": "Button2url"
				}
			},
			'actionButtons': {
				plugin: true,
				displayOnRelated: true,
				templatePath: '../CallToAction/templates/action-button-related.tmpl.html'
			},
			'related': {
				plugin: true,
				itemsLimit: 5
			},
			'metadataProfileId': 8644902
		}
	});
</script>

</body>
</html>